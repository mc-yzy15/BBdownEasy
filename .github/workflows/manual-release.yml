name: Manual Release

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write

jobs:
  package-and-release:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # è·å–å®Œæ•´æäº¤å†å²

    - name: Setup environment
      run: |
        mkdir -p Publish/Actions
        DATE_TIME=$(date +'%Y-%m-%d_%H-%M')

    - name: Package Windows files
      run: |
        cd src
        zip "../Publish/Actions/BBdownWindows_$DATE_TIME.zip" BBdownEasy.bat bbdownInstall.bat
        cd ..

    - name: Package Linux files
      run: |
        cd src
        tar -czvf "../Publish/Actions/BBdownLinux_$DATE_TIME.tar.gz" BBdownEasy.sh bbdownInstall.sh
        cd ..

    - name: Get commit logs
      id: changelog
      run: |
        echo "logs=$(git log --oneline -n 10 | sed ':a;N;$!ba;s/\n/\\n/g')" >> $GITHUB_OUTPUT

    - name: Create release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: release-${{ env.DATE_TIME }}
        name: AutoRelease ${{ env.DATE_TIME | replace('_', ' ') }}
        body: |
          ğŸš€ è‡ªåŠ¨æ„å»ºå‘å¸ƒç‰ˆæœ¬
          - æ„å»ºæ—¶é—´: ${{ env.DATE_TIME | replace('_', ' ') }}
          - æœ€è¿‘æäº¤è®°å½•:
          ${{ steps.changelog.outputs.logs }}
        files: |
          Publish/Actions/BBdownWindows_${{ env.DATE_TIME }}.zip
          Publish/Actions/BBdownLinux_${{ env.DATE_TIME }}.tar.gz