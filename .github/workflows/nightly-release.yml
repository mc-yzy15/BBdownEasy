name: Nightly Release

on:
  schedule:
    - cron: '0 16 * * *'  # 每天UTC时间16:00运行(北京时间午夜12点)
  workflow_dispatch:  # 允许手动触发

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        ref: dev  # 使用dev分支
        fetch-depth: 0  # 获取完整提交历史

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.10.0'  # 锁定具体版本

    - name: Get current date
      id: date
      run: echo "date=$(date +'%Y-%m-%d')" >> $GITHUB_OUTPUT

    - name: Create release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: nightly-${{ steps.date.outputs.date }}
        name: Nightly Build (${{ steps.date.outputs.date }})
        body: |
          ⚡ 自动构建的夜间版本
          - 构建时间: ${{ steps.date.outputs.date }}
          - 源码版本: ${{ github.sha }}
        prerelease: true
        draft: false
        files: |
          src/**/*  # 递归包含所有文件
